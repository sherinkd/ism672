@using NWTradersWeb.Models;
@model Customer

@{

    ViewBag.Title = "Analysis";
    Customer currentCustomer = Session["currentCustomer"] as Customer;
    List<string> yearsList = ViewBag.YearsList;
    yearsList.Insert(0, "All Years");
    string year = ViewBag.Year;
}

<div class="">

    <div class="container">
        <div class="border-secondary-subtle">
            <div class="btn w3-hover-shadow" title="View your orders and related details">
                @Html.ActionLink("Home", "Details", "Customers",
                    new { @id = currentCustomer.CustomerID },
                    new { @class = "text-decoration-none" })
            </div>

            <div class="btn w3-hover-shadow" title="View analysis">
                @Html.ActionLink("Analysis", "Analysis", "Customers",
                   new { @id = currentCustomer.CustomerID },
                   new { @class = "text-decoration-none" })
            </div>

        </div>
    </div>

    <br />

    <nav class="navbar bg-body-tertiary">
        <form class="container">
            <div class="d-flex align-items-center">
                <div class="input-group-sm p-2">
                    <div class="input-group-sm ">Fiscal Year</div>
                    @Html.DropDownList("Year", new SelectList(yearsList),
                         new
                         {
                             @class = "form-select form-control",
                             @id = "SelectYear",
                             @value = year,
                             onchange = "RefreshPage();"
                         })
                </div>
            </div>
        </form>
    </nav>

    <div class="container">

        <ul class="nav nav-tabs small border-0">

            <li class="nav-item pl-2">
                <div class="w3-button w3-bottombar w3-hover-light-gray w3-hover-shadow rounded-2x"
                     onclick="AnnualSales();" id="AnnualSales" style="cursor:pointer"
                     title="Left for you to complete">
                    Annual Sales
                </div>
            </li>

            <li class="nav-item px-2">
                <div class="w3-button w3-bottombar w3-hover-light-gray w3-hover-shadow rounded-2x"
                     onclick="TopProducts();" id="TopProducts" style="cursor:pointer"
                     title="Top Products Bought by @Model.CompanyName">
                    Top Products
                </div>
            </li>

            <li class="nav-item px-2">
                <div class="w3-button w3-bottombar w3-hover-light-gray w3-hover-shadow rounded-2x"
                     onclick="ForYouToComplete();" id="TopProductCategories" style="cursor:pointer"
                     title="Categories of the Top Products Bought by @Model.CompanyName">
                    Top Product Categories
                </div>
            </li>

            <li class="nav-item px-2">
                <div class="w3-button w3-bottombar w3-hover-light-gray w3-hover-shadow rounded-2x"
                     onclick="ForYouToComplete();" id="Discounts" style="cursor:pointer"
                     title="This can be here or on the details(Home) Page for the customer">
                    Valued Customer Discounts
                </div>
            </li>
        </ul>
    </div>

    <div class=" shadow-sm rounded-2x tab-pane mt-4 w3-animate-bottom">

        <!-- Partials are dropped into this container. -->
        <div id="Partials" class="" style="min-height:400px">

        </div>

    </div>

</div>


<script type="text/javascript">

    $(document).ready(function ()
    {
        AnnualSales();
    });

     function AnnualSales()
     {
        $('.tab').removeClass(' w3-light-gray active border-secondary');        
        $('#Partials').empty();
         var year = $('#SelectYear').val();
         $.ajax({
            url: '@Url.Action("AnnualSales", "Customers")',
            data: { Year: year },

            success: function (result) { $('#Partials').html(result); },
            error: function () { $('#Partials').html('Something went wrong in Annual Orders'); }
        });
    }

    function TopProducts()
    {
        debugger;
        $('#Partials').empty();
        var year = $('#SelectYear').val();
         $.ajax({
            url: '@Url.Action("TopProducts", "Customers")',
             data: { Year: year },

            success: function (result) { $('#Partials').html(result); },
            error: function () { $('#Partials').html('Something went wrong in Customer Top Products'); }
        });
    }


    function TopCategories()
    {
      
        $('.tab').removeClass(' w3-light-gray active border-secondary');
        $('#Partials').empty();
        var year = $('#SelectYear').val();
         $.ajax({
            url: '@Url.Action("CustomerTopCategories", "Customers")',
             data: { Year: year },

            success: function (result) { $('#Partials').html(result); },
            error: function () { $('#Partials').html('Something went wrong in Customer Top Products'); }
        });
    }

    function ForYouToComplete()
    {
        $('.tab').removeClass(' w3-light-gray active border-secondary');
        $('#Partials').empty();
    }


</script>
